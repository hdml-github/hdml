<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="680px" preserveAspectRatio="none" style="width:582px;height:680px;background:#FFFFFF;" version="1.1" viewBox="0 0 582 680" width="582px" zoomAndPan="magnify"><defs/><g><rect height="26.2969" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="136" x="221.5" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="226.5" y="32.9951">Add Query Flow</text><ellipse cx="291" cy="57.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><polygon fill="#F1F1F1" points="139.5,87.2969,452.5,87.2969,442.5,121.2656,129.5,121.2656" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="303" x="139.5" y="108.4355">tenant: string, token: string, fragment: unknown</text><rect fill="none" height="190.2031" style="stroke:#000000;stroke-width:1.5;" width="418" x="82" y="131.2656"/><path d="M123,131.2656 L123,140.5625 L113,150.5625 L82,150.5625 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="85" y="145.2607">auth</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="273" x="154.5" y="167.5625"/><line style="stroke:#181818;stroke-width:0.5;" x1="159.5" x2="159.5" y1="167.5625" y2="201.5313"/><line style="stroke:#181818;stroke-width:0.5;" x1="422.5" x2="422.5" y1="167.5625" y2="201.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="253" x="164.5" y="188.7012">const env: Env = await readEnv(tenant);</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="315" x="133.5" y="221.5313"/><line style="stroke:#181818;stroke-width:0.5;" x1="138.5" x2="138.5" y1="221.5313" y2="255.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="443.5" x2="443.5" y1="221.5313" y2="255.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="295" x="143.5" y="242.6699">const key: string = await readKey(env, tenant);</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="398" x="92" y="275.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="97" x2="97" y1="275.5" y2="309.4688"/><line style="stroke:#181818;stroke-width:0.5;" x1="485" x2="485" y1="275.5" y2="309.4688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="378" x="102" y="296.6387">const user: User = await authenticateUser(env, key, token);</text><rect fill="none" height="190.2031" style="stroke:#000000;stroke-width:1.5;" width="560" x="11" y="331.4688"/><path d="M60,331.4688 L60,340.7656 L50,350.7656 L11,350.7656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="14" y="345.4639">patch</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="540" x="21" y="367.7656"/><line style="stroke:#181818;stroke-width:0.5;" x1="26" x2="26" y1="367.7656" y2="401.7344"/><line style="stroke:#181818;stroke-width:0.5;" x1="556" x2="556" y1="367.7656" y2="401.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="520" x="31" y="388.9043">const document: HDMLDocument = await completeHDMLDocument(env, fragment);</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="334" x="124" y="421.7344"/><line style="stroke:#181818;stroke-width:0.5;" x1="129" x2="129" y1="421.7344" y2="455.7031"/><line style="stroke:#181818;stroke-width:0.5;" x1="453" x2="453" y1="421.7344" y2="455.7031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="314" x="134" y="442.873">await patchHDMLDocument(env, user, document);</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="377" x="102.5" y="475.7031"/><line style="stroke:#181818;stroke-width:0.5;" x1="107.5" x2="107.5" y1="475.7031" y2="509.6719"/><line style="stroke:#181818;stroke-width:0.5;" x1="474.5" x2="474.5" y1="475.7031" y2="509.6719"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="357" x="112.5" y="496.8418">const query: Query = await createQuery(env, document);</text><rect fill="#F1F1F1" height="33.9688" style="stroke:#181818;stroke-width:0.5;" width="232" x="175" y="541.6719"/><line style="stroke:#181818;stroke-width:0.5;" x1="180" x2="180" y1="541.6719" y2="575.6406"/><line style="stroke:#181818;stroke-width:0.5;" x1="402" x2="402" y1="541.6719" y2="575.6406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212" x="185" y="562.8105">await addQuery(env, user, query);</text><polygon fill="#F1F1F1" points="262,595.6406,330,595.6406,320,629.6094,252,629.6094" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="262" y="616.7793">query.qid</text><ellipse cx="291" cy="659.6094" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="284.8128" x2="297.1872" y1="653.4222" y2="665.7966"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="297.1872" x2="284.8128" y1="653.4222" y2="665.7966"/><line style="stroke:#181818;stroke-width:1.0;fill:none;" x1="291" x2="291" y1="67.2969" y2="87.2969"/><polygon fill="#181818" points="287,77.2969,291,87.2969,295,77.2969,291,81.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="201.5313" y2="221.5313"/><polygon fill="#181818" points="287,211.5313,291,221.5313,295,211.5313,291,215.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="255.5" y2="275.5"/><polygon fill="#181818" points="287,265.5,291,275.5,295,265.5,291,269.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="121.2656" y2="167.5625"/><polygon fill="#181818" points="287,157.5625,291,167.5625,295,157.5625,291,161.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="401.7344" y2="421.7344"/><polygon fill="#181818" points="287,411.7344,291,421.7344,295,411.7344,291,415.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="455.7031" y2="475.7031"/><polygon fill="#181818" points="287,465.7031,291,475.7031,295,465.7031,291,469.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="309.4688" y2="367.7656"/><polygon fill="#181818" points="287,357.7656,291,367.7656,295,357.7656,291,361.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="509.6719" y2="541.6719"/><polygon fill="#181818" points="287,531.6719,291,541.6719,295,531.6719,291,535.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="575.6406" y2="595.6406"/><polygon fill="#181818" points="287,585.6406,291,595.6406,295,585.6406,291,589.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="291" x2="291" y1="629.6094" y2="649.6094"/><polygon fill="#181818" points="287,639.6094,291,649.6094,295,639.6094,291,643.6094" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[37e65126dd1f81dadb42e0022b73b9aa]
@startuml AddQueryFlow
  title Add Query Flow

  start
  :tenant: string, token: string, fragment: unknown/
  partition auth {
    :const env: Env = await readEnv(tenant);|
    :const key: string = await readKey(env, tenant);|
    :const user: User = await authenticateUser(env, key, token);|
  }
  partition patch {
    :const document: HDMLDocument = await completeHDMLDocument(env, fragment);|
    :await patchHDMLDocument(env, user, document);|
    :const query: Query = await createQuery(env, document);|
  }
  :await addQuery(env, user, query);|
  :query.qid/
  end
@enduml

PlantUML version 1.2022.5(Sat Apr 30 13:55:52 EEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>