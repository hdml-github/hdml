# @author Artem Lytvynov
# @copyright Artem Lytvynov
# @license Apache-2.0

name: Push and PR to the `master` branch

on:
  push:
    paths:
      - '.github/workflows/master.yml'
      - '.github/workflows/release.yml'
      - 'docker/**'
      - 'packages/**'
      - 'tsconfig/**'
      - '.eslintrc.js'
      - '.gitignore'
      - '.jestrc.js'
      - '.rollup.config.js'
      - '.test.config.js'
      - 'lerna.json'
      - 'package-lock.json'
      - 'package.json'
      - 'README.md'
    branches:
      - 'master'
  pull_request:
    paths:
      - '.github/workflows/**'
      - 'docker/**'
      - 'packages/**'
      - 'tsconfig/**'
      - '.eslintrc.js'
      - '.gitignore'
      - '.jestrc.js'
      - '.rollup.config.js'
      - '.test.config.js'
      - 'lerna.json'
      - 'package-lock.json'
      - 'package.json'
      - 'README.md'

jobs:
  build:
    runs-on: ubuntu-latest
    container: imazzine/hdml.io-devtools:latest
    timeout-minutes: 30
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Installing `Node.js`
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Installing `playwright` dependencies
        run: npx playwright install-deps
      - name: Installing `hdml` dependencies
        run: npm ci
      - name: Bootstraping `hdml`
        run: npm run bootstrap
      - name: Building `hdml`
        run: npm run build