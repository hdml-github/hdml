<!DOCTYPE html>
<html>
  <head>
    <script src="/bin/elements.min.js"></script>
    <script>
      const hdml = window['@hdml/elements'];
      (async () => {await hdml.defineDefaults();})();
    </script>
  </head>
    <body>
      <hdml-io
        name="hdml.io"
        host="http://localhost:8888"
        tenant="common"
        token="eyJhbGciOiJSU0EtT0FFUC0yNTYiLCJlbmMiOiJBMjU2R0NNIn0.dZztg-grohkP7WETtTF8Obai_79SD1-BfGBh5TLzlUA4IhueurGlpKwllqonZly8bwT9qgAxD-kn0-_40RkPQ7NcX3R9cYlg7CBJFKDsOYMm5nbq8VyKhijw7AtimsVaVRgf3vGTCaHfORA2H2uxq8cGa37rXvINXOhwPghzWpMoF4kzPpQKCGYVBB3LCR2onqCxuhTleH5qU428lRxzmwC_0UefqSyI6edlgI5gC3cLhDgnEXC1PEj4iyYEFl1pa5z5ibHSpTuWL20yJHlOAHgLgukKYnWJBQELgVS9JRjnYg1EJub_b_x47h9Q6wS4FKvbUtA0uyEl9dlBwiZCu5FIQSf61JecfqKLmkJ9e8Lg2G2KdZ_ySlzHvs4awdlRDJ3SFqVVLAC8ORpv2J74FcnvMYFXQImVlbsNd3ma0qF-oHPE1rWpi3t8FqX3kyOo53gFVKHw0J9HXp5KZubMXf2lw7SaEipUak-wTew01ksFrjHpKB5Mn-pyhS8qlKYW.5LyQPlwyYR--SQPs.US6DY6-LCyjA1eWfXd3cbzjKgRRXn20ODsTGNllqxScnC9bA3tWea3oG-3aONJPVEHDZ07q43ZXDsVfcq5Q6gCX3nmyDMb0C5n2QPVLIKgXid243HuHd1aIJ4R3hkPrkQ5BxuC8-Pu70E-a3H1tXDnT_LSgm.fUzEZsUDqF_jljEI7eWaiw">
      </hdml-io>

      <hdml-model
        name="model">
        <hdml-table
          name="tables"
          type="table"
          source="`tenant_postgres`.`information_schema`.`tables`">
          <hdml-field
            name="catalog"
            origin="table_catalog">
          </hdml-field>
          <hdml-field
            name="schema"
            origin="table_schema">
          </hdml-field>
          <hdml-field
            name="table"
            origin="table_name">
          </hdml-field>
          <hdml-field
            name="full"
            clause="concat(`table_catalog`, '-', `table_schema`, '-', `table_name`)">
          </hdml-field>
          <hdml-field
            name="hash"
            clause="concat(`table_catalog`, '-', `table_schema`, '-', `table_name`)"
            type="binary">
          </hdml-field>
          <hdml-field
            name="type"
            origin="table_type">
          </hdml-field>
        </hdml-table>

        <hdml-table
          name="columns"
          type="query"
          source="select * from `tenant_postgres`.`information_schema`.`columns`">
          <hdml-field
            name="catalog"
            origin="table_catalog">
          </hdml-field>
          <hdml-field
            name="schema"
            origin="table_schema">
          </hdml-field>
          <hdml-field
            name="table"
            origin="table_name">
          </hdml-field>
          <hdml-field
            name="column"
            origin="column_name">
          </hdml-field>
          <hdml-field
            name="position"
            origin="ordinal_position"
            type="int-32">
          </hdml-field>
          <hdml-field
            name="default"
            origin="column_default">
          </hdml-field>
          <hdml-field
            name="nullable"
            origin="is_nullable">
          </hdml-field>
          <hdml-field
            name="type"
            origin="data_type">
          </hdml-field>
        </hdml-table>

        <hdml-join
          type="inner"
          left="tables"
          right="columns">
          <hdml-connective
            operator="and">
            <hdml-filter
              type="keys"
              left="catalog"
              right="catalog">
            </hdml-filter>
            <hdml-filter
              type="keys"
              left="schema"
              right="schema">
            </hdml-filter>
            <hdml-filter
              type="keys"
              left="table"
              right="table">
            </hdml-filter>            
            <hdml-connective
              operator="or">
              <hdml-filter
                type="expr"
                clause="`columns`.`table` = 'applicable_roles'">
              </hdml-filter>
              <hdml-filter
                type="expr"
                clause="`columns`.`table` = 'tables'">
              </hdml-filter>
            </hdml-connective>
          </hdml-connective>
        </hdml-join>
      </hdml-model>

      <hdml-frame
        name="frame"
        source="/models/model.html?hdml-model=model"
        offset="0"
        limit="1000">
        <hdml-field
          name="catalog"
          origin="columns_catalog">
        </hdml-field>
        <hdml-field
          name="schema"
          origin="columns_schema">
        </hdml-field>
        <hdml-field
          name="table"
          origin="columns_table">
        </hdml-field>
        <hdml-field
          name="column"
          origin="columns_column">
        </hdml-field>
        <hdml-field
          name="count"
          origin="columns_column"
          agg="count">
        </hdml-field>

        <hdml-group-by>
          <hdml-field
            name="catalog">
          </hdml-field>
          <hdml-field
            name="schema">
          </hdml-field>
          <hdml-field
            name="table">
          </hdml-field>
          <hdml-field
            name="column">
          </hdml-field>
        </hdml-group-by>
      </hdml-frame>

      <hdml-frame
        name="query"
        source="/frames/frame.html?hdml-frame=frame">
        <div>
          <hdml-field
            name="catalog">
          </hdml-field>
          <hdml-field
            name="schema">
          </hdml-field>
          <hdml-field
            name="table">
          </hdml-field>
          <hdml-field
            name="sum"
            origin="count"
            agg="sum">
          </hdml-field>
        </div>

        <div>
          <hdml-filter-by>
            <hdml-connective
              operator="and">
              <hdml-filter
                type="expr"
                clause="`catalog` = 'tenant_postgres'">
              </hdml-filter>
              <hdml-filter
                type="expr"
                clause="`schema` = 'information_schema'">
              </hdml-filter>
            </hdml-connective>
          </hdml-filter-by>
        </div>

        <div>
          <hdml-group-by>
            <hdml-field
              name="catalog">
            </hdml-field>
            <hdml-field
              name="schema">
            </hdml-field>
            <hdml-field
              name="table">
            </hdml-field>
          </hdml-group-by>
        </div>

        <div>
          <hdml-sort-by>
            <hdml-field
              name="catalog">
            </hdml-field>
            <hdml-field
              name="schema">
            </hdml-field>
            <hdml-field
              name="table"
              asc="false">
            </hdml-field>
          </hdml-sort-by>
        </div>
      </hdml-frame>

      <script>
        const io = document.querySelector("hdml-io");
        console.log(io.json);
      </script>
    </body>
</html>
