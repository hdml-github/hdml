<!DOCTYPE html>
<html>
  <head>
    <title>Product Profit Data Model</title>
    <script src="https://cdn.example.com/hdml.min.js"></script>
  </head>
  <body>
    <data-io
      name="data.io"
      tenant="common"
      token="gwkcc9k31daqq9909hdshk1==">
    </data-io>

    <data-frame
      name="product_profit"
      from="/models/sales.html?model=sales"
      limit="50000">

      <data-fields>
        <data-field
          name="code"
          origin="codes.code"/>
        <data-field
          name="name"
          origin="products.name"/>
        <data-field
          name="date"
          clause="date_trunc('day', sales.date)"/>
        <data-field
          name="total_quantity"
          origin="orders.quantity"
          agg="sum"/>
        <data-field
          name="total_price"
          origin="orders.price"
          agg="sum"/>
        <data-field
          name="total_cost"
          origin="orders.cost"
          agg="sum"/>
        <data-field
          name="profit"
          type="float-32"
          clause="total_price - total_cost"/>
      </data-fields>

      <group-by>
        <data-field name="product"/>
        <data-field name="date"/>
      </group-by>

      <split-by>
        <data-field name="date"/>
      </split-by>

      <sort-by>
        <data-field name="code" desc/>
      </sort-by>

    </data-frame>
  </body>
</html>